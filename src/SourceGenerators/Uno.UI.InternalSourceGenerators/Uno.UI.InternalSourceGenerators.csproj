<Project Sdk="MSBuild.Sdk.Extras">
	<PropertyGroup>
		<TargetFrameworks>net461;netstandard2.0</TargetFrameworks>
		<AssemblyName>Uno.UI.InternalSourceGenerators</AssemblyName>
		<AppendTargetFrameworkToOutputPath>true</AppendTargetFrameworkToOutputPath>
		<WarningsAsErrors>true</WarningsAsErrors>
		<CopyLocalLockFileAssemblies>true</CopyLocalLockFileAssemblies>
		<TreatWarningsAsErrors>true</TreatWarningsAsErrors>

		<!-- This target must always be built, regardless of the CI override -->
		<TargetFrameworksOverrideInvariant>netstandard2.0</TargetFrameworksOverrideInvariant>
	</PropertyGroup>

	<ItemGroup Condition="'$(TargetFramework)'=='net461'">
		<PackageReference Include="Microsoft.NETFramework.ReferenceAssemblies" Version="1.0.0" PrivateAssets="All" />
		<PackageReference Include="Microsoft.ApplicationInsights" Version="2.20.0" />
		<PackageReference Include="Microsoft.Build" Version="15.4.8" ExcludeAssets="runtime" />
		<PackageReference Include="Microsoft.Build.Engine" Version="15.4.8" ExcludeAssets="runtime" />
		<PackageReference Include="Microsoft.Build.Tasks.Core" Version="15.4.8" ExcludeAssets="runtime" />
		<PackageReference Include="Microsoft.CodeAnalysis">
			<Version>3.3.1</Version>
			<ExcludeAssets>runtime</ExcludeAssets>
		</PackageReference>
		<PackageReference Include="Microsoft.CodeAnalysis.Common">
			<Version>3.3.1</Version>
			<ExcludeAssets>runtime</ExcludeAssets>
		</PackageReference>
		<PackageReference Include="Microsoft.CodeAnalysis.CSharp">
			<Version>3.3.1</Version>
			<ExcludeAssets>runtime</ExcludeAssets>
		</PackageReference>
		<PackageReference Include="Microsoft.CodeAnalysis.CSharp.Workspaces">
			<Version>3.3.1</Version>
			<ExcludeAssets>runtime</ExcludeAssets>
		</PackageReference>
		<PackageReference Include="Microsoft.CodeAnalysis.Workspaces.Common">
			<Version>3.3.1</Version>
			<ExcludeAssets>runtime</ExcludeAssets>
		</PackageReference>
		<PackageReference Include="Microsoft.DotNet.PlatformAbstractions">
			<Version>3.1.6</Version>
		</PackageReference>
		<PackageReference Include="Mono.Cecil">
			<Version>0.10.1</Version>
		</PackageReference>
		<PackageReference Include="Uno.SourceGeneration" />
	</ItemGroup>

	<ItemGroup Condition="'$(TargetFramework)'=='netstandard2.0' or '$(TargetFramework)'=='net5.0'">
		<PackageReference Include="Microsoft.DotNet.PlatformAbstractions">
			<Version>3.1.6</Version>
		</PackageReference>
		<PackageReference Include="Microsoft.ApplicationInsights" Version="2.20.0" />
		<PackageReference Include="System.Collections.Immutable" Version="5.0.0" />
		<PackageReference Include="Microsoft.CodeAnalysis">
			<Version>3.8.0</Version>
		</PackageReference>
		<PackageReference Include="Mono.Cecil">
			<Version>0.10.1</Version>
		</PackageReference>
	</ItemGroup>

	<Import Project="..\..\Uno.Foundation\Uno.Core.Extensions\Uno.Core.Extensions.props" />

	<ItemGroup>
	  <Compile Include="..\..\Uno.Foundation.Runtime.WebAssembly\Interop\TSInteropMessageAttribute.wasm.cs" Link="TSBindings\TSInteropMessageAttribute.cs" />
	  <Compile Include="..\Uno.UI.SourceGenerators\Helpers\DependenciesInitializer.cs" Link="Helpers\DependenciesInitializer.cs" />
	  <Compile Include="..\Uno.UI.SourceGenerators\Helpers\DesignTimeHelper.cs" Link="Helpers\DesignTimeHelper.cs" />
	  <Compile Include="..\Uno.UI.SourceGenerators\Helpers\GeneratorExecutionContextExtensions.cs" Link="Helpers\GeneratorExecutionContextExtensions.cs" />
	  <Compile Include="..\Uno.UI.SourceGenerators\Helpers\HashBuilder.cs" Link="Helpers\HashBuilder.cs" />
	  <Compile Include="..\Uno.UI.SourceGenerators\Helpers\PlatformHelper.cs" Link="Helpers\PlatformHelper.cs" />
	  <Compile Include="..\Uno.UI.SourceGenerators\Helpers\SymbolExtensions.cs" Link="Helpers\SymbolExtensions.cs" />
	  <Compile Include="..\Uno.UI.SourceGenerators\XamlGenerator\XamlConstants.cs" Link="XamlGenerator\XamlConstants.cs" />
	</ItemGroup>

	<ItemGroup>
		<ProjectReference Include="..\System.Xaml\Uno.Xaml.csproj">
			<Project>{1627740a-19d2-4d21-a0b2-66667038daf6}</Project>
			<Name>Uno.Xaml</Name>
			<Aliases>__uno</Aliases>
			<SetTargetFramework>TargetFramework=netstandard2.0</SetTargetFramework>
		</ProjectReference>
	</ItemGroup>

	<Target Name="_UnoToolkitOverrideNuget" AfterTargets="AfterBuild" DependsOnTargets="BuiltProjectOutputGroup" Condition="'$(UnoNugetOverrideVersion)'!=''">
		<PropertyGroup>
			<_baseNugetPath Condition="'$(USERPROFILE)'!=''">$(USERPROFILE)</_baseNugetPath>
			<_baseNugetPath Condition="'$(HOME)'!=''">$(HOME)</_baseNugetPath>

			<_TargetNugetFolder Condition="'$(TargetFramework)'=='net461'">$(_baseNugetPath)\.nuget\packages\Uno.UI\$(UnoNugetOverrideVersion)\tools\uno-sourcegen</_TargetNugetFolder>
			<_TargetNugetFolder Condition="'$(TargetFramework)'=='netstandard2.0'">$(_baseNugetPath)\.nuget\packages\Uno.UI\$(UnoNugetOverrideVersion)\analyzers\dotnet\cs</_TargetNugetFolder>
		</PropertyGroup>
		<ItemGroup>
			<_OutputFiles Include="$(TargetDir)**" />
		</ItemGroup>
		<MakeDir Directories="$(_TargetNugetFolder)" />
		<Message Importance="high" Text="OVERRIDING NUGET PACKAGE CACHE: $(_TargetNugetFolder)" />
		<Copy SourceFiles="@(_OutputFiles)" DestinationFiles="@(_OutputFiles->'$(_TargetNugetFolder)\%(RecursiveDir)%(Filename)%(Extension)')" />
		<Copy SourceFiles="@(_OutputFilesPDB)" DestinationFiles="@(_OutputFilesPDB->'$(_TargetNugetFolder)\%(RecursiveDir)%(Filename).pdb')" />
	</Target>

	<Target Name="GetTargetPath" />
	<Target Name="GetCopyToPublishDirectoryItems" />
</Project>
