<Project>
	<PropertyGroup>
		<IsBrowserWasm>true</IsBrowserWasm>
		<UsingUnoCommonWasmTargets>true</UsingUnoCommonWasmTargets>
		<UnoRuntimeIdentifier>WebAssembly</UnoRuntimeIdentifier>

		<EnableDefaultWasmItems Condition="$(EnableDefaultWasmItems) == ''">false</EnableDefaultWasmItems>

		<!-- Enable the netx.0-browserwasm target -->
		<TargetPlatformIdentifier>BrowserWasm</TargetPlatformIdentifier>
		<TargetFrameworkIdentifier>BrowserWasm</TargetFrameworkIdentifier>
		<TargetPlatformSupported>true</TargetPlatformSupported>
		<TargetPlatformVersion>$([System.Text.RegularExpressions.Regex]::Match($(TargetFramework), '\d+.\d+'))</TargetPlatformVersion>
		<SupportedOSPlatformVersion Condition=" $(SupportedOSPlatformVersion) == '' ">8.0</SupportedOSPlatformVersion>
	</PropertyGroup>

	<!-- Enable the netx.0-browserwasm target -->
	<ItemGroup>
		<SupportedPlatform Remove="@(SupportedPlatform)" />
		<SupportedPlatform Include="browserwasm" />
		<SdkSupportedTargetPlatformVersion Include="$(TargetPlatformVersion)" />
	</ItemGroup>

	<!-- Enable the netx.0-browserwasm target -->
	<ItemGroup Condition=" '$(TargetFrameworkIdentifier)' == '.NETCoreApp' and $([MSBuild]::VersionGreaterThanOrEquals($(TargetFrameworkVersion), '8.0')) ">
		<SdkSupportedTargetPlatformIdentifier Include="browserwasm" DisplayName="BrowserWasm" />
	</ItemGroup>

	<Target Name="_UnoGenerateGlobalUsingsMock"
			BeforeTargets="CoreCompile"
			Condition=" '$(Optimize)' != 'true' AND '$(UnoDisableGenerateGlobalUsingsMock)'!='true' ">
		
		<!-- 
			This target is present to work around global usings that provided by the .NET Web SDK
			that we cannot remove reliably, particular during Hot Reload. 
			As a workaround we generate a temporary file that contains the namespaces and private 
			types that will make global using namespaces valid at compile time.
		-->

		<PropertyGroup>
			<_FakeGlobalUsingsFile>$(IntermediateOutputPath)/FakeGlobalUsings.g.cs</_FakeGlobalUsingsFile>
			<_AssemblyName>$(AssemblyName.Replace('.','_'))</_AssemblyName>
		</PropertyGroup>

		<ItemGroup>
			<_UsingsDedup Include="@(Using)" Name="%(Identity)" KeepDuplicates="false" />
			<_Lines Include="@(_UsingsDedup->'namespace %(Name) { class __PlaceHolderDoNotUse_$(_AssemblyName) { } }')" />
		</ItemGroup>

		<WriteLinesToFile File="$(_FakeGlobalUsingsFile)" Lines="@(_Lines)" WriteOnlyWhenDifferent="true" Overwrite="true" />

		<ItemGroup>
			<Compile Include="$(_FakeGlobalUsingsFile)" Visible="False" />
			<FileWrites Include="$(_FakeGlobalUsingsFile)" />
		</ItemGroup>
	</Target>


	<Import Project="$(MSBuildThisFileDirectory)..\targets\Uno.SingleProject.Wasm.targets"
			Condition=" $(SingleProject) == 'true' " />
</Project>
